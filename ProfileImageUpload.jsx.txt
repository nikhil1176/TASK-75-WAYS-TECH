ProfileImageUpload.jsx

import React, {useRef,useState} from "react";
import Cropper from "react-cropper";


const ProfileImageUpload= () =>{
const cropperRef = useRef (null);
const [image,setImage] = useState(null);
const [preview, setPreview] =useState(null);

const userID =1;//let it be logged in userID

//Selecting Image

const onFileChange = (e)=>{
const file =e.target .files[0];
if(!file)return ;

const reader = new FileReader();
render.onload= () =>{
setImage (read.result);
};
reader.readAsDataURL(file);
};

//Crop and upload

const cropAndUpload =()=>{
const cropper = cropperref.current?.cropper;
if(!cropper) return;

cropper.getCroppedCanvas({
width:300,height:300}).toBlob(blob) =>{
const formData = new FormData();

formData.append("image",blob,"profile.jpg");
formData.append("userID",userID);

fetch("/upload-update-profile",{
method:"POST",
body:formData})
.then(res=> res.json())
.then(()=> {
setPreview(URL.createObjectURL(blob));
setImage(null);
alert("Profile image updated successfully");
})
.catch(() => alert("Upload Failed")):
}, "image/jpeg");
};


return(

<div style={{ textAlign:"center", marginTop:"40px"}}>
<h2>Upload Profile Image</h2>

<img
src= {preview || "default.png"}
alt="Profile"
style={{ width:150,
height:150,
borderRadius:"50%",
objectFit:"cover", 
border:"2px solid #456"
}}
/>


<div input type = "file" accept= "image/"
onChange ={onFileChange}/>
</div>

{image && (
<>
<Cropper
src={image}
style={{height:"300", width:"100%", marginTop:20}}
aspectRation={1}
viewMode={1}
guides={false}
ref={croppedRef}
/>

<button onClick ={cropAndUpload}
style={{ marginTop:15}}>
Crop & Upload
</button>
</>
)}
</div>
);
);
export default ProfileImageUpload;




// APP.jsx

import ProfileImageUpload from "./ProfileImageUpload";

function App(){
return <ProfileImageUpload/>;
}

export default App;